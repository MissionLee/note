# 数据整合及管理体系

## 概述

`核心:从业务架构设计到模型设计,从数据研发到数据服务,做到数据可管理,可追溯,可规避重复建设.`

## 定位及价值

`建设统一的,规范化的数据接入层(ODS)和数据中间层(DWD和DWS),通过数据服务和数据产品,完成服务于整个企业的数据系统建设,即数据公共层建设.提供标准化的,共享的,数据服务能力,降低数据互通成本,释放计算,存储,人力等资源`

## 体系架构

## 规范定义

### 名词术语

### 指标体系

`省了好多东西`

## 模型设计

### 指导理论

Star Schema-The Complete Reference 和 The Data Warehouse Toolkit-The Definitive Guide to Dimensional Modeling.数据模型的维度设计主要以维度建模理论为基础,基于维度数据模型总线架构,构建一致性的维度和实时.

### 模型层次

主要分为三层

- 操作数据层 ODS ↓
- 公共唯独模型层 CDM ↓
  - 明细数据层 DWD ↓
  - 汇总数据层 DWS ↓
- 应用数据层 ADS -

解析:

- 操作数据层(ODS):把操作系统数据几乎无处理的存放在数据仓库系统中.
  - 同步:增量或全量
  - 结构化:非结构化进行结构化处理并存储
  - 累积历史,清洗:根据数据业务需求及稽核和审计要求保持历史数据,清洗数据
- 公共维度模型层(CDM):存放`明细事实数据`,`维表数据`及`公共指标汇总数据`,其中
  - `明细事实数据`,`维表数据`一般根据ODS层数据加工生成
  - 公共指标汇总数据一般根据维表数据和明细试试数据加工生成
  - CDM有细分为DWD层和DWS层,分别是`明细数据层`和`汇总数据层`,采用`维度模型方法`作为理论基础,更多的采用一些`维度退化手法`,讲维度退化至事实表中,减少事实表和维表的关联,提高明细数据表的易用性;
  - 同时在`汇总数据层`,加强指标的维度退化,采取更多的`宽表化手段`构建公共指标数据层,提升公共指标的复用性,减少重复加工.其主要功能如下
    - 组合相关和相似的数据:采用明细宽表,复用关联计算,减少数据扫描
    - 公共指标统一加工:基于OneData体系构建命名规范,口径一致和算法统一的统计指标,为上层数据产品,应用和服务提供公共指标;建立逻辑汇总宽表.
    - 建立一致性维度:建立一支的数据分析维表,降低数据计算口径,算法不统一的风险.
- 应用数据层(ADS):存放数据产品个性化的统计指标数据,根据CDM层与ODS层加工生成
  - 个性化指标加工:不公用性,复杂性(指数型,比值性,命名型指标)
  - 基于应用的数据组装:大宽表集市,横标转纵表,趋势指标串

数据调用服务,优先使用公共维度模型层(CDM)数据,当公共层没有数据时,评估是否需要创建公共层数据,当不需要建设公用的公共层时,方可直接使用操作数据层(ODS)数据.应用数据层(ADS)作为产品特有的个性化数据,一般不对外提供数据服务,但是ADS最为被服务方也需要遵守这个约定.

### 基本原则

- 高内聚低耦合:将业务相近或相关,粒度相同的数据设计为一个逻辑或者物理模型;将高概率同时访问的数据放在一起,将低概率同时访问的数据分开存储.
- 核心模型和扩展模型分离:建立和新模型与扩展模型体系,和新模型包括的字段支持常用的核心业务,扩展模型包括的字段支持个性化或少量应用的需求.
- 公共处理逻辑下沉及单一:越是底层公用的处理逻辑月应该在数据调度依赖的底层进行封装与实现,不要让公用的处理逻辑暴露给应用层实现,不要让公共逻辑多处同时存在.
- 成本与性能平衡:适当的冗余和可以换取查询和刷新性能,不宜过度冗余与数据复制
- 一致性:具有相同含义的字段在不同表中的命名必须相同,必须使用规范定义中的名称
- 命名清晰,可理解

## 模型实施

### 业界常用的模型实施过程

- Kimball 模型实施过程
  - 高层设计:定义业务过程,维度模型的范围,提供每种星形模式的技术和功能描述
    - 直接产出目标是创建高层维度模型图,它是对业务过程中的维表和事实表的图形描述.确定维表创建初始属性列表,为每个事实创建提议度量
  - 详细模型:对每个星星模型添加属性和度量信息
    - 为高层模型填补缺失的信息,解决设计问题,并不断测试模型是否满足业务需求,确保模型的完备性.确定每个维表的属性和每个事实表的度量,并确定信息来源的位置,定义,确定属性和度量如何填入模型的初步业务规则
  - 模型审查,再设计,验证
    - 召集相关人员进行模型的审查和验证,根据结果进行再设计
  - 产生详细设计文档,提交ETL设计与开发
    - 完成详细设计文档,提交ETL开发人员,进入ETL设计和开发阶段,由ETL人员完成物理模型设计和开发
  ![](./resource/001.png)
- Inmon模型实施过程
  - Inmon定位:扮演者通往数据仓库和其他部分的智能路线图的角色.=>一个路线图=>数据模型,描述数据仓库各部分是如何结合在一起的
  - ERD(Entity Relationship Diagram,实体关系图)层
    - 最高层,描述公司业务中的实体或主题域以及他们之间的关系;
  - DIS(Data Item Set,数据项集)层
    - 中间层,描述了数据模型中的关键字,属性以及细节数据之间的关系
  - 物理层(Physical Model,物理模型)
    - 最底层,描述模型的物理特性
  - 建议采用螺旋式开发方法,采用迭代方式完成多次需求.但需要采用统一的ERD模型,才能够将每次迭代的结果整合在一起.ERD是高度抽象的数据模型.
- 其他模型实施过程
  - 业务建模:生成业务模型,解决业务层面的分解和程序化
  - 领域建模:生成领域模型,针对业务模型进行抽象,生成领域模型的概念模型
  - 逻辑建模:生成逻辑模型,主要将领域模型的概念实体一级实体之间的关系进行数据库层次的逻辑化
  - 物理建模:生成物理模型,解决物理化,性能,以及一些具体的技术问题
  ![](./resource/002.png)