# 大数据建模

## 为什么需要数据建模

- 良好的数据模型,适合业务和基础数据存储环境的模型
  - 性能:帮助我们快速查询所需的数据,减少数据的I/O吞吐
  - 成本:减少不必要的数据冗余,也能实现计算结果复用,极大降低存储和计算成本
  - 效率:改善用户使用数据的体验,提高使用数据的效率
  - 质量:改善数据统计口径不一致性,减少计算错误的可能

## 关系数据库系统和数据仓库

`不管Hadoop,Spark还仍然大规模使用SQL进行数据的加工和处理,仍然用Table存储数据,仍然用关系理论描述数据间关系,只是在大数据领域,基于其存取特点,在关系数据模型的范式上有了不同的选择而已`

## 从OLTP和OLAP系统的区别看模型方法论的选择

- OLTP:面向随机读写,主要采用满足3NF的实体关系模型存储数据,从而在事务处理中解决数据的冗余和一致性问题
- OLAP:批量都写,主要关注数据的整合,以及在一次性的复杂大数据查询和处理中的性能.

## 经典的数据仓库建模方法论

### ER模型 3NF模型 Entity Relationship

- `数据仓库中的3NF与OLAP系统中的3NF区别在于,它是站在企业角度面向主题的抽象,而不是针对某个具体,有以下几个特点`
  - 需要全面了解企业业务和数据
  - 实施周期非常长
  - 对建模人员的能力要求非常高

`将各个系统中的数据以整个企业角度按主题进行相似性组合和合并,并进行一致性处理,为数据分析决策服务,但是并不能直接用于分析决策`

- 建模步骤
  - 高层模型:一个高度抽象的模型,描述主要的主题以及主题间的关系,用于描述企业的业务总体概况
  - 中层模型:在高层模型的基础之上,细化主题的数据项
  - 物理模型(底层模型):在中层模型行的基础之上,考虑物理存储,同事基于性能和平台特点进行物理属性的设计,也可能做一些表的合并,分区的设计等

### 维度模型

`维度建模从分析决策的需求出发构建模型,为分析需求服务,因此重点关注用户如何快速的完成需求分析,同事具有较好的大规模负责查询的响应性能,典型代表是星形模型,以及在一些特殊场景下使用的雪花模型`

- 设计步骤
  - 选择需要进行分析决策的业务过程:可以使单个业务事件比如,交易的支付,退款等,亦可以是某个事件的状态,比如账户余额,还可以是一些列相关业务事件组成的业务流程.具体需求看我们分析的是某种事件发生情况,还是当前状态,或是时间流转效率
  - 选择粒度:在事件分析中,我们要预判所有分析需要的细分的程度,从而决定选择的粒度.粒度是维度的一个组合
  - 识别维表:选择好粒度之后,就需要基于此粒度设计为表,包括维度属性,用于分析时进行分组和筛选
  - 选择事实.确定分析需要衡量的标准

### Data Vault 模型

`ER模型的衍生,为了实现数据的整合,但不能直接用于分析决策.强调建立一个可审计的数据基础层,也就是强调数据的历史性,可追溯性和原子性,而不要求对数据进行国度的一致性处理和整合,同时它基于主题概念,将企业数据进行结构化组织,并引入了更进一步的凡是处理来优化模型,以应对原系统变更的扩展性`

- Data Vault 模型组成
  - Hub:企业的核心业务实体,由实体Key,数据仓库序列代理键,装载时间,数据来源组成
  - Link:Hub之间的关系.这里与ER模型最大的区别是将关系作为一个独立的单元抽象,可以提升模型的扩展性.可以直接描述1:1,1:n和n:n的关系,而不需要任何改变.它由Hub代理键,装在时间,数据来源组成
  - Satellite:Hub的详细描述内容,一个Hub可以有多个Satellite.它由Hub的代理键,装在时间,来源类型,详细的Hub描述信息组成

`Data Vault 模型比ER更容易设计和产出,它的ETL加工可实现配置话.`

Hub为骨,Link为韧带,Satellite为血肉

## Anchor 模型

`Anchor 对 Data Vault模型做了进一步规范化处理.其核心思想是所有的扩展只是添加而不是修改,因此将模型规范到6NF,基本变成了k-v结构化模型`

- Anchor 模型构成
  - Anchors:类似于Hub,代表业务实体,只有主键
  - Attributes:类似Satellite,但是更加规范化,将其全部k-v结构化,一个表只有一个Anchors的属性描述
  - Ties:Anchors之间的关系,单独用表来描述,类似于Link,提升模型扩展能力
  - Knots:代表可能会在多个Anchors中公用的属性的提炼,比如性别,状态等枚举类型且被公用的属性
- 上述四个基本对象的基础上,又分为历史和非历史